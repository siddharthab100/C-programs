/*     Tic-Tac-Toe Game
    components of the game
    1) print Board
    2) update Board
    3) who won the board?
    4) who chose what symbol and who goes first?
    5) How would the transition happen from player to player?
    6) what would the board initially be?
    7) what if the player want to mark a position that's already marked?

*/

#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<time.h>
#include<ctype.h>
struct computer
{
  char mark;
  int choice;
} compu;
char board[10] = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9' };

void printBoard ();
int checkForWin ();
int mrkBoard (char, int);

void
main ()
{
  srand (time (NULL));
  int i, intro = 0;
  int player, choice;
  int gameStatus, signalForMarking;
  char mark;
  char str[10];
  while (intro == 0)
	{
	  intro++;
	  printf
		("Who do you want to go first? write 'me' for you or just computer\n");
	  scanf ("%s", str);
	  if (strcmp (str, "me") == 0 || strcmp (str, "Me") == 0
		  || strcmp (str, "ME") == 0)
		player = 0;
	  else if (strcmp (str, "computer") == 0 || strcmp (str, "Computer") == 0)
		player = 1;
	  else
		{
		  printf ("Enter valid first player ");
		  intro--;
		}

	}
  intro = 0;
  while (intro == 0)
	{
	  intro++;
	  printf ("Enter your mark\n");
	  getchar ();
	  mark = getchar ();

	  if (mark != 'x' && mark != 'X' && mark != 'O' && mark != 'o')
		{
		  printf ("Enter valid mark\n");
		  intro--;
		  continue;
		}
	}
  mark = toupper (mark);
  if (mark == 'X')
	compu.mark = 'O';
  else
	compu.mark = 'X';
  i = 0;
  do
	{
	  printBoard ();
	  if (i % 2 == player)
		{
		  i++;
		  printf ("Enter choice position\n");
		  scanf ("%d", &choice);
		  signalForMarking = mrkBoard (mark, choice);
		  if (signalForMarking == 0)
			{
			  printf ("Enter Valid position\n");
			  i--;
			  continue;
			}
		  gameStatus = checkForWin ();
		  if (gameStatus == 1)
			{
			  printBoard ();
			  printf ("You won");
			}
		  else if (gameStatus == 0)
			{
			  printf ("The game is draw");
			  exit (0);
			}
		}
	  else
		{
		  i++;
		  compu.choice = rand () % 9 + 1;
		  signalForMarking = mrkBoard (compu.mark, compu.choice);
		  if (signalForMarking == 0)
			{
			  i--;
			  continue;
			}
		  gameStatus = checkForWin ();
		  if (gameStatus == 1)
			{

			  printBoard ();
			  printf ("Computer won");
			}
		  else if (gameStatus == 0)
			{
			  printf ("The game is draw");
			  exit (0);
			}
		}
	}
  while (gameStatus == -1);

}


int
checkForWin ()
{
  int returnValue = 0;
  if (board[1] == board[2] && board[2] == board[3])
	{
	  returnValue = 1;
	}
  else if (board[4] == board[5] && board[5] == board[6])
	returnValue = 1;
  else if (board[7] == board[8] && board[8] == board[9])
	returnValue = 1;
  else if (board[1] == board[5] && board[5] == board[9])
	returnValue = 1;
  else if (board[3] == board[5] && board[5] == board[7])
	returnValue = 1;
  else if (board[1] == board[4] && board[4] == board[7])
	returnValue = 1;
  else if (board[2] == board[5] && board[5] == board[8])
	returnValue = 1;
  else if (board[3] == board[6] && board[6] == board[9])
	returnValue = 1;
  else if (board[1] != '1' && board[2] != '2' && board[3] != '3'
		   && board[4] != '4' && board[5] != '5' && board[6] != '6'
		   && board[7] != '7' && board[8] != '8' && board[9] != '9')
	returnValue = 0;
  else
	returnValue = -1;
  return returnValue;
}

void
printBoard ()
{
  //system("cls");
  printf ("\n\nTic Tac Toe\n\n");

  printf ("Player 1 (X) - Player 2 (O)\n\n\n");

  printf ("     |     |     \n");
  printf ("  %c  |  %c  |  %c \n", board[1], board[2], board[3]);

  printf ("_____|_____|_____\n");
  printf ("     |     |     \n");

  printf ("  %c  |  %c  |  %c\n", board[4], board[5], board[6]);

  printf ("_____|_____|_____\n");
  printf ("     |     |     \n");

  printf ("  %c  |  %c  |  %c\n", board[7], board[8], board[9]);
  printf ("     |     |     \n\n");
}

int
mrkBoard (char mark, int choice)
{


  if (choice == 1 && board[1] == '1')
	board[1] = mark;
  else if (choice == 2 && board[2] == '2')
	board[2] = mark;
  else if (choice == 3 && board[3] == '3')
	board[3] = mark;
  else if (choice == 4 && board[4] == '4')
	board[4] = mark;
  else if (choice == 5 && board[5] == '5')
	board[5] = mark;
  else if (choice == 6 && board[6] == '6')
	board[6] = mark;
  else if (choice == 7 && board[7] == '7')
	board[7] = mark;
  else if (choice == 8 && board[8] == '8')
	board[8] = mark;
  else if (choice == 9 && board[9] == '9')
	board[9] = mark;
  else
	{
	  return 0;
	}
  return 1;
}
